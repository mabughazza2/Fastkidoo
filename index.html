<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#f0b429">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ุงูุตุงุฆู ุงูุตุบูุฑ">
<title>ูุบุงูุฑุฉ ุงูุตุงุฆู ุงูุตุบูุฑ ๐</title>
<link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" href="./icon.svg" type="image/svg+xml">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./styles.css">
</head>
<body data-theme="night">
<div id="sync-indicator">๐ ุชุญุฏูุซ...</div>
<div id="app">

<!-- ===== WELCOME ===== -->
<!-- ===== LANDING (Role Selection) ===== -->
<div id="screen-welcome" class="screen active">
  <div class="welcome-wrap" style="gap:14px">
    <div class="welcome-moon">๐</div>
    <h1 class="welcome-title">ูุบุงูุฑุฉ<br>ุงูุตุงุฆู ุงูุตุบูุฑ</h1>
    <p class="welcome-sub">ุฑูุถุงู ูุจุงุฑู 1447 ูู ๐คฒ</p>

    <!-- WHO ARE YOU? -->
    <div style="width:100%;max-width:320px">
      <p class="bold text-center mb-8" style="font-size:1.05rem">ูู ุฃูุชุ</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px">

        <!-- KID CARD -->
        <button id="btn-role-kid" style="background:linear-gradient(145deg,rgba(240,180,41,0.18),rgba(240,180,41,0.05));border:2px solid var(--accent);border-radius:18px;padding:22px 10px;cursor:pointer;font-family:var(--font);transition:transform .15s,box-shadow .15s;display:flex;flex-direction:column;align-items:center;gap:8px" onmouseover="this.style.transform='scale(1.04)'" onmouseout="this.style.transform='scale(1)'">
          <span style="font-size:3rem">๐ง</span>
          <span class="bold" style="font-size:1rem;color:var(--accent)">ุฃูุง ุทูู</span>
          <span class="text-xs text-muted">ุงูุนุจ ูุชูุงูุณ!</span>
        </button>

        <!-- PARENT CARD -->
        <button id="btn-role-parent" style="background:linear-gradient(145deg,rgba(56,201,176,0.18),rgba(56,201,176,0.05));border:2px solid var(--teal);border-radius:18px;padding:22px 10px;cursor:pointer;font-family:var(--font);transition:transform .15s,box-shadow .15s;display:flex;flex-direction:column;align-items:center;gap:8px" onmouseover="this.style.transform='scale(1.04)'" onmouseout="this.style.transform='scale(1)'">
          <span style="font-size:3rem">๐จโ๐ฉโ๐ง</span>
          <span class="bold" style="font-size:1rem;color:var(--teal)">ุฃูุง ูููู ุฃูุฑ</span>
          <span class="text-xs text-muted">ุชุงุจุน ุฃุทูุงูู</span>
        </button>

      </div>

      <!-- existing kids (shown when profiles exist) -->
      <div id="existing-profiles" style="display:flex;flex-direction:column;gap:8px;margin-bottom:8px"></div>

      <button class="btn btn-ghost btn-block btn-sm" id="btn-welcome-theme" style="margin-bottom:6px">๐จ ุงุฎุชุฑ ุงููุธูุฑ</button>
      <button class="btn btn-ghost btn-block btn-sm" id="btn-enter-code">๐ ูุฏูู ุฑูุฒ ุนุงุฆูุฉ</button>

      <div id="install-bar-welcome" class="install-bar hidden" style="margin-top:10px">
        <span style="font-size:1.6rem">๐ฒ</span>
        <div style="flex:1"><div class="bold text-sm">ุซุจูุช ุงูุชุทุจูู ุนูู ุฌูุงุฒู</div><div class="text-xs text-muted">ูุนูู ุจุฏูู ุฅูุชุฑูุช!</div></div>
        <button class="btn btn-primary btn-sm" id="btn-install">ุชุซุจูุช</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== SETUP ===== -->
<div id="screen-setup" class="screen">
  <div class="flex gap-8 mb-12">
    <button class="btn btn-ghost btn-sm" id="btn-back-welcome">โ ุฑุฌูุน</button>
    <div style="flex:1;text-align:center" class="bold text-accent">ุฅูุดุงุก ูููู ๐</div>
  </div>
  <!-- Step 0 -->
  <div class="setup-step active" data-step="0">
    <div class="step-hdr"><div class="step-icon">๐</div><h2>ุฃููุงู ุจู!</h2><p class="text-muted text-sm">ุฃุฎุจุฑูุง ุนูู</p></div>
    <div class="flex-col gap-12">
      <div><label class="bold text-sm">ุงุณูู</label><input type="text" id="s-name" placeholder="ุงูุชุจ ุงุณูู ููุง..." maxlength="30" autocomplete="off" style="margin-top:5px"></div>
      <div><label class="bold text-sm">ุนูุฑู</label><input type="number" id="s-age" placeholder="ุนูุฑู..." min="3" max="16" value="8" style="margin-top:5px"></div>
    </div>
    <button class="btn btn-primary btn-lg btn-block mt-16" id="btn-s0">ุงูุชุงูู โ</button>
  </div>
  <!-- Step 1 -->
  <div class="setup-step" data-step="1">
    <div class="step-hdr"><div class="step-icon">๐ญ</div><h2>ุงุฎุชุฑ ุตูุฑุชู</h2></div>
    <div class="avatar-tabs" id="av-tabs"></div>
    <div class="avatar-grid" id="av-grid"></div>
    <div style="margin-top:12px"><div class="bold text-sm mb-8">ุงูููู ุงูููุถู</div><div class="color-grid" id="col-grid"></div></div>
    <button class="btn btn-primary btn-lg btn-block mt-16" id="btn-s1">ุงูุชุงูู โ</button>
  </div>
  <!-- Step 2 -->
  <div class="setup-step" data-step="2">
    <div class="step-hdr"><div class="step-icon">โญ</div><h2>ุงุฎุชุฑ ุดุฎุตูุชู</h2></div>
    <div class="hero-grid" id="hero-grid"></div>
    <button class="btn btn-primary btn-lg btn-block mt-16" id="btn-s2">ุงูุชุงูู โ</button>
  </div>
  <!-- Step 3 -->
  <div class="setup-step" data-step="3">
    <div class="step-hdr"><div class="step-icon">โก</div><h2>ูุณุชูู ุงูุชุญุฏู</h2></div>
    <div class="diff-grid">
      <div class="diff-btn selected" data-d="easy"><div style="font-size:1.8rem">๐ธ</div><div class="bold">ุณูู</div><div class="text-xs text-muted">ูููุจุชุฏุฆูู</div></div>
      <div class="diff-btn" data-d="normal"><div style="font-size:1.8rem">โญ</div><div class="bold">ุนุงุฏู</div><div class="text-xs text-muted">ููุดุฌุนุงู</div></div>
      <div class="diff-btn" data-d="hero"><div style="font-size:1.8rem">๐</div><div class="bold">ุจุทู</div><div class="text-xs text-muted">ููุฃุจุทุงู!</div></div>
    </div>
    <button class="btn btn-primary btn-lg btn-block mt-16" id="btn-s3">ุงูุชุงูู โ</button>
  </div>
  <!-- Step 4 -->
  <div class="setup-step" data-step="4">
    <div class="step-hdr"><div class="step-icon">๐๏ธ</div><h2>ุฎุทุชู ูุฑูุถุงู</h2><p class="text-muted text-sm">ุงููุฌููุน ูุง ูุชุฌุงูุฒ 30 ูููุงู</p></div>
    <div class="flex-col gap-10">
      <div class="card"><div class="slider-lbl"><span>๐ ุฃูุงู ุงูุธูุฑ</span><span class="slider-val" id="lbl-d">15 ููู</span></div><input type="range" id="sl-d" min="0" max="30" value="15"></div>
      <div class="card"><div class="slider-lbl"><span>๐ ุฃูุงู ุงูุนุตุฑ</span><span class="slider-val" id="lbl-a">10 ููู</span></div><input type="range" id="sl-a" min="0" max="30" value="10"></div>
      <div class="card"><div class="slider-lbl"><span>๐ ุฃูุงู ุงููุบุฑุจ</span><span class="slider-val" id="lbl-m">5 ููู</span></div><input type="range" id="sl-m" min="0" max="30" value="5"></div>
    </div>
    <div class="total-info" id="total-info">โ ุงููุฌููุน: 30 ูููุงู</div>
    <button class="btn btn-primary btn-lg btn-block mt-16" id="btn-s4">๐ ุงุจุฏุฃ ุฑูุถุงู!</button>
  </div>
</div>

<!-- ===== HOME ===== -->
<div id="screen-home" class="screen">
  <div class="home-hdr">
    <div class="home-av" id="h-av">๐</div>
    <div style="flex:1;min-width:0">
      <div class="home-greet" id="h-greet">ุฑูุถุงู ูุจุงุฑู</div>
      <div class="home-name" id="h-name">ุงููุบุงูุฑ</div>
    </div>
    <div class="day-badge" id="h-day">ููู 1</div>
  </div>
  <div id="notif-bar" class="notif-bar hidden"><span style="font-size:1.3rem">๐</span><span style="flex:1;font-size:0.83rem">ูุนูู ุงูุชูุจููุงุช ูุชุฐููุฑู ุจููุช ุงูุฅูุทุงุฑ!</span><button class="btn btn-secondary btn-sm" id="btn-notif">ูุนูู</button></div>
  <div id="status-card" class="status-card status-pending"></div>
  <div class="timer-card">
    <div class="timer-lbl">ุงูุนุฏ ุงูุชูุงุฒูู ุญุชู</div>
    <div class="timer-name" id="t-name">ุงููุฏู: ุงููุบุฑุจ</div>
    <div class="timer-display" id="t-main">00:00:00</div>
    <div style="font-size:0.82rem;color:var(--muted);margin-top:3px" id="t-sub">๐ช ุงุณุชูุฑ!</div>
    <div class="prog-labels mt-8"><span>ุงููุฌุฑ</span><span>ุงููุบุฑุจ</span></div>
    <div class="prog-track"><div class="prog-fill" id="p-fill" style="width:0%"></div><div class="prog-marker" id="p-marker" style="right:50%"></div></div>
  </div>
  <div id="bonus-card" class="status-card status-success hidden flex" style="align-items:center;gap:12px">
    <div style="flex:1"><div class="bold text-sm">๐ ุจููุต ุญุชู ุงููุบุฑุจ!</div><div id="bonus-timer" class="text-sm" style="color:var(--teal)">00:00:00</div></div>
    <button class="btn btn-success btn-sm" id="btn-maghrib">ุงุทูุจ ุงูููุงูุฃุฉ!</button>
  </div>
  <button id="btn-quiz" class="quiz-banner-big" style="width:100%;text-align:right;cursor:pointer;border:none;padding:0;font-family:var(--font);display:block;margin-bottom:14px">
    <div class="quiz-banner-inner">
      <div class="quiz-banner-art">๐ง</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:1.05rem;font-weight:900;color:var(--accent)">ูุณุงุจูุฉ ุฑูุถุงู ุงูููููุฉ</div>
        <div class="text-sm" id="quiz-banner-sub" style="color:var(--muted);margin-top:2px">10 ุฃุณุฆูุฉ ุฑูุถุงููุฉ โ ุงูุณุจ ููุงุทุงู!</div>
        <div style="margin-top:8px;display:inline-block;background:var(--accent);color:var(--text-on-accent);font-size:0.78rem;font-weight:900;padding:4px 14px;border-radius:20px">โถ ุงูุชุญ ุฎุฑูุทุฉ ุงูุฑุญูุฉ</div>
      </div>
      <div style="font-size:2rem;opacity:0.6">๐บ๏ธ</div>
    </div>
  </button>

  <!-- Owned items (from shop) -->
  <div class="section-hdr mt-12"><div class="section-title">๐ ููุชููุงุชู</div><div class="badge" id="inv-count">0</div></div>
  <div id="inv-strip" class="inv-strip"></div>
  <div class="section-hdr"><div class="section-title">๐ ุฃุนูุงูู ุงูุญุณูุฉ</div><div class="badge">+ููุงุท</div></div>
  <div class="deeds-grid" id="deeds-grid"></div>
  <div id="bad-deeds-section" class="hidden">
    <div class="section-hdr mt-12"><div class="section-title" style="color:var(--rose)">โ๏ธ ููุงุญุธุงุช ุงููุงูุฏูู</div></div>
    <div id="bad-deeds-list"></div>
  </div>
  <div class="section-hdr mt-8"><div class="section-title">๐ ููุงู ุงูููู</div><div class="badge" id="q-badge">0/7</div></div>
  <div id="quest-list"></div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:10px">
    <button class="btn btn-ghost btn-sm" id="btn-night">๐ ุงููุธูุฑ</button>
    <button class="btn btn-ghost btn-sm" id="btn-cert-home">๐ ุดูุงุฏุชู</button>
  </div>
</div>

<!-- ===== PROGRESS ===== -->
<div id="screen-progress" class="screen">
  <div class="screen-title">๐บ๏ธ ุฑุญูุชู ูู ุฑูุถุงู</div>

  <!-- Stats bar -->
  <div class="xp-bar-wrap"><div class="xp-header"><span class="bold">ูุณุชูุงู</span><span class="level-badge" id="pr-level">ูุจุชุฏุฆ ๐ฑ</span></div><div class="xp-track"><div class="xp-fill" id="pr-xp" style="width:0%"></div></div><div class="text-xs text-muted mt-8" id="pr-xp-lbl">0 / 200 ููุทุฉ</div></div>
  <div class="stats-grid" style="margin-bottom:16px">
    <div class="stat-card"><div class="stat-val" id="st-pts">0</div><div class="stat-lbl">ูุฌููุน ุงูููุงุท</div></div>
    <div class="stat-card"><div class="stat-val" id="st-streak">0๐ฅ</div><div class="stat-lbl">ุฃูุงู ูุชุชุงููุฉ</div></div>
    <div class="stat-card"><div class="stat-val" id="st-days">0</div><div class="stat-lbl">ุฃูุงู ูุงุฌุญุฉ</div></div>
    <div class="stat-card"><div class="stat-val" id="st-grace">3</div><div class="stat-lbl">ุฏุฑุน ุงูุญูุงูุฉ</div></div>
  </div>

  <!-- ====== JOURNEY (levels) ====== -->
  <div class="section-hdr"><div class="section-title">๐บ๏ธ ูุณูุฑุฉ ุงููุบุงูุฑุฉ</div></div>
  <div id="journey-list"></div>

  <!-- Achievements -->
  <div class="section-hdr mt-12"><div class="section-title">๐ ุงูุฃูุณูุฉ</div></div>
  <div class="ach-grid" id="ach-grid"></div>
  <div class="section-hdr mt-12"><div class="section-title">๐ ุณุฌู ุงูุฃุนูุงู</div></div>
  <div id="activity-log"></div>
</div>

<!-- ===== SHOP ===== -->
<div id="screen-shop" class="screen">
  <div class="screen-title">๐ช ุงููุชุฌุฑ</div>
  <div style="background:linear-gradient(135deg,rgba(56,201,176,0.15),rgba(240,180,41,0.1));border:1.5px solid var(--teal);border-radius:13px;padding:10px 14px;text-align:center;margin-bottom:12px">
    <div class="text-xs text-muted mb-8">ุงููุชุฌุฑ ูุณุชุฎุฏู ๐ ุงูุฌูุงูุฑ ููุท โ ููุงุท ุงูุชูุงูุณ ูุง ุชุชุฃุซุฑ</div>
    <span style="font-size:1.4rem">๐</span> <span class="bold" style="font-size:1.3rem;color:var(--teal)" id="shop-gems">0</span> <span class="text-muted text-sm">ุฌููุฑุฉ</span>
    <span style="margin-right:12px" class="text-xs text-muted">| ููุงุท ุงูุชูุงูุณ: <span class="text-accent bold" id="shop-comp-pts">0</span></span>
  </div>
  <div class="shop-grid" id="shop-grid"></div>
</div>

<!-- ===== PROFILES / FAMILY ===== -->
<div id="screen-profiles" class="screen">
  <div class="screen-title">๐ ุชุฑุชูุจ ุงูุนุงุฆูุฉ</div>
  <p class="text-xs text-muted text-center mb-12">ููุงุท ุฌููุน ุฃูุฑุงุฏ ุงูุนุงุฆูุฉ โ ูููุดุงูุฏุฉ ููุท</p>
  <div id="profiles-list"></div>
  <p class="text-xs text-muted text-center mt-12" style="opacity:0.6">ุชูุงูุณ ูุฏู โ ูู ุฌูุงุฒ ุญุณุงุจู ุงูุฎุงุต ๐</p>
</div>

<!-- ===== QUIZ ===== -->
<div id="screen-quiz" class="screen">
  <div class="flex gap-8 mb-12"><button class="btn btn-ghost btn-sm" id="btn-quiz-back">โ ุฑุฌูุน</button><div class="screen-title" style="flex:1;margin:0">๐ง ูุณุงุจูุฉ ุฑูุถุงู</div></div>
  <!-- 29-day quiz path map โ shown before quiz starts -->
  <div id="quiz-path-map"></div>
  <div id="quiz-container"></div>
</div>

<!-- ===== CERTIFICATE ===== -->
<div id="screen-certificate" class="screen">
  <div class="flex gap-8 mb-12"><button class="btn btn-ghost btn-sm" id="btn-cert-back">โ ุฑุฌูุน</button><button class="btn btn-secondary btn-sm" onclick="window.print()">๐จ๏ธ ุทุจุงุนุฉ</button></div>
  <div class="screen-title">๐ ุดูุงุฏุฉ ุงูุชูุฏูุฑ</div>
  <div class="cert-frame">
    <!-- FIX: ุจุณู ุงููู at TOP -->
    <div style="font-family:'Amiri',serif;font-size:1.1rem;color:var(--accent);font-weight:700;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(240,180,41,0.3)">ุจูุณููู ุงูููู ุงูุฑููุญููููู ุงูุฑููุญููู ๐คฒ</div>
    <div style="font-size:2.3rem;margin-bottom:6px">๐</div>
    <div style="font-family:'Amiri',serif;font-size:1.2rem;color:var(--accent);font-weight:700;margin-bottom:6px">ุดูุงุฏุฉ ุตุงุฆู ุตุบูุฑ ูุชููุฒ</div>
    <div style="font-size:2.8rem;margin:6px 0" id="cert-av">๐</div>
    <div class="cert-name" id="cert-name">โ</div>
    <div style="display:inline-block;background:rgba(240,180,41,0.15);border:1px solid var(--accent);color:var(--accent);padding:3px 13px;border-radius:18px;font-size:0.82rem;margin:5px 0" id="cert-level">โ</div>
    <div class="text-muted text-sm" style="margin:5px 0">ุฃุชู ุจูุฌุงุญ</div>
    <div style="font-size:1.7rem;font-weight:900;color:var(--accent)" id="cert-days">0 ููู</div>
    <!-- FIX: ุดูุฑ ุฑูุถุงู ุงููุจุงุฑู -->
    <div class="text-muted text-sm">ูู ุดูุฑ ุฑูุถุงู ุงููุจุงุฑู 1447 ูู</div>
    <div class="cert-row"><div><span id="cert-pts">0</span> ููุทุฉ</div><div><span id="cert-streak">0</span> ููู ูุชุชุงูู ๐ฅ</div></div>
    <div class="text-xs text-muted" id="cert-date"></div>
  </div>
  <div class="card mt-12"><div class="section-title mb-8">๐ ุชุฑุชูุจ ุงูุนุงุฆูุฉ</div><div id="cert-ranks"></div></div>
</div>

<!-- ===== PARENT ===== -->
<div id="screen-parent" class="screen">
  <div class="flex gap-8 mb-12"><button class="btn btn-ghost btn-sm" id="btn-parent-back">โ ุฑุฌูุน</button><div class="screen-title" style="flex:1;margin:0">ููุญุฉ ุงููุงูุฏูู ๐</div></div>

  <!-- FIRST TIME: Create PIN -->
  <div id="parent-create-pin" class="parent-lock hidden">
    <div style="font-size:3.5rem">๐</div>
    <h3 style="margin:0 0 6px">ุฅูุดุงุก ุฑูู ุณุฑู ูููุงูุฏูู</h3>
    <p class="text-muted text-sm" style="margin:0 0 16px;max-width:260px;text-align:center">ูุฐุง ุงูุฑูู ููุญูุธ ุนูู ุฌูุงุฒู ููุท ููุง ูุฑุงู ุงูุฃุทูุงู</p>
    <input type="password" id="pin-create-1" placeholder="ุฃุฏุฎู ุฑููุงู ุณุฑูุงู (4+ ุฃุฑูุงู)" inputmode="numeric" maxlength="8"
      style="max-width:220px;text-align:center;font-size:1.5rem;letter-spacing:6px;margin-bottom:10px">
    <input type="password" id="pin-create-2" placeholder="ุฃุนุฏ ุงูุฅุฏุฎุงู ููุชุฃููุฏ" inputmode="numeric" maxlength="8"
      style="max-width:220px;text-align:center;font-size:1.5rem;letter-spacing:6px;margin-bottom:14px">
    <button class="btn btn-primary" id="btn-save-pin">๐พ ุญูุธ ุงูุฑูู ุงูุณุฑู</button>
  </div>

  <!-- RETURNING: Enter PIN -->
  <div id="parent-lock" class="parent-lock hidden">
    <div style="font-size:3.5rem">๐</div>
    <h3 style="margin:0 0 6px">ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู</h3>
    <p class="text-muted text-sm" style="margin:0 0 16px">ูููุงูุฏูู ููุท</p>
    <input type="password" id="math-ans" placeholder="โขโขโขโข" inputmode="numeric" maxlength="8"
      style="max-width:180px;text-align:center;font-size:1.8rem;letter-spacing:8px">
    <button class="btn btn-primary" id="btn-pin">ุฏุฎูู โ</button>
    <button class="btn btn-ghost btn-sm" id="btn-forgot-pin" style="margin-top:8px;font-size:0.8rem">ูุณูุช ุงูุฑููุ (ุฅุนุงุฏุฉ ุถุจุท)</button>
  </div>
  <div id="parent-panel" class="hidden flex-col gap-10">
    <!-- Tabs: 3 per row, 2 rows -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:7px">
      <button class="ptab-btn active" data-tab="children" id="ptab-children">๐ถ<br><span>ุงูุฃุทูุงู</span></button>
      <button class="ptab-btn" data-tab="deeds" id="ptab-deeds">โ<br><span>ุงูุฃุนูุงู</span></button>
      <button class="ptab-btn" data-tab="fasting" id="ptab-fasting">๐<br><span>ุงูุฃุณุฆูุฉ</span></button>
      <button class="ptab-btn" data-tab="questions" id="ptab-questions">๐ง<br><span>ุงูุฃุณุฆูุฉ</span></button>
      <button class="ptab-btn" data-tab="rewards" id="ptab-rewards">๐<br><span>ุงูููุงูุขุช</span></button>
      <button class="ptab-btn" data-tab="settings" id="ptab-settings">โ๏ธ<br><span>ุงูุฅุนุฏุงุฏุงุช</span></button>
    </div>
    <!-- Children tab -->
    <div id="ptab-children-content">
      <div id="parent-children-list"></div>
      <div class="card mt-8">
        <div class="bold mb-8">๐ ุฑูุฒ ุงูุฑุจุท ุจุงูุนุงุฆูุฉ</div>
        <p class="text-sm text-muted mb-8">ุฃุนุทู ูุฐุง ุงูุฑูุฒ ูุฃู ุทูู ููุฏุฎู ูู ุฌูุงุฒู</p>
        <div style="font-size:2rem;font-weight:900;color:var(--accent);text-align:center;letter-spacing:6px;background:var(--surf);border-radius:12px;padding:12px" id="family-code">โโ</div>
        <div id="supabase-status" style="text-align:center;font-size:0.75rem;margin:8px 0;padding:6px;border-radius:8px;background:var(--surf2)">
          โณ ุฌุงุฑู ุงูุชุญูู ูู ุงูุงุชุตุงู...
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:8px">
          <button class="btn btn-ghost btn-sm" id="btn-regen-code">๐ ุฑูุฒ ุฌุฏูุฏ</button>
          <button class="btn btn-primary btn-sm" id="btn-test-conn">๐ก ุงุฎุชุจุงุฑ ุงูุงุชุตุงู</button>
        </div>
      </div>
    </div>
    <!-- Deeds/Log tab -->
    <div id="ptab-deeds-content" class="hidden">
      <div class="card">
        <div class="bold mb-8">โ๏ธ ุฅุถุงูุฉ ููุงุญุธุฉ ุณูุจูุฉ</div>
        <select id="bad-deed-select" style="margin-bottom:7px"><option value="">ุงุฎุชุฑ ุงูุณููู...</option></select>
        <select id="bad-deed-child" style="margin-bottom:7px"><option value="">ุงุฎุชุฑ ุงูุทูู...</option></select>
        <button class="btn btn-danger btn-block btn-sm" id="btn-add-bad">โ ุฅุถุงูุฉ ุงูููุงุญุธุฉ</button>
      </div>
      <div class="card mt-8">
        <div class="bold mb-8">โ ุทูุจุงุช ุงูุฃุนูุงู ุงูุญุณูุฉ</div>
        <div id="pending-deeds-list"><p class="text-muted text-sm text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ูุนููุฉ</p></div>
      </div>
      <div class="card mt-8">
        <div class="flex gap-8 mb-8"><div class="bold" style="flex:1">๐ ุณุฌู ุงูุฃุนูุงู</div><select id="log-filter-child" style="width:auto;padding:4px 8px;font-size:0.8rem"><option value="">ุงููู</option></select></div>
        <div id="parent-log-list"></div>
      </div>
      <div class="card mt-8">
        <div class="bold mb-8">โ๏ธ ุชุนุฏูู ููุงุท</div>
        <select id="edit-pts-child" style="margin-bottom:6px"><option value="">ุงุฎุชุฑ ุงูุทูู...</option></select>
        <div class="flex gap-6">
          <input type="number" id="edit-pts-val" placeholder="ุนุฏุฏ ุงูููุงุท..." style="flex:1">
          <button class="btn btn-success btn-sm" id="btn-add-pts">+ ุฅุถุงูุฉ</button>
          <button class="btn btn-danger btn-sm" id="btn-rem-pts">- ุฎุตู</button>
        </div>
      </div>
      <div class="card mt-8">
        <div class="bold mb-8">๐ ููุญ ุฌูุงูุฑ</div>
        <p class="text-xs text-muted mb-8">ุงูุฌูุงูุฑ ุชูุณุชุฎุฏู ูู ุงููุชุฌุฑ ููุง ุชุคุซุฑ ุนูู ููุงุท ุงูุชูุงูุณ</p>
        <select id="edit-gems-child" style="margin-bottom:6px"><option value="">ุงุฎุชุฑ ุงูุทูู...</option></select>
        <div class="flex gap-6">
          <input type="number" id="edit-gems-val" placeholder="ุนุฏุฏ ุงูุฌูุงูุฑ..." style="flex:1" min="1">
          <button class="btn btn-primary btn-sm" id="btn-add-gems">๐ ููุญ</button>
          <button class="btn btn-danger btn-sm" id="btn-rem-gems">- ุฎุตู</button>
        </div>
      </div>
    </div>
    <!-- Questions tab -->
    <div id="ptab-fasting-content" class="hidden">
      <!-- Full 300 questions editor -->
      <div class="card mb-8">
        <div class="bold mb-8" style="font-size:1rem">๐ ุงูุฃุณุฆูุฉ ุงููุงููุฉ (300 ุณุคุงู)</div>
        <p class="text-xs text-muted mb-10">ููููู ุชุนุฏูู ุฃู ุณุคุงู ุฃู ุญุฐูู. ุงูุชุนุฏููุงุช ุชุคุซุฑ ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ.</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
          <input type="text" id="allq-search" placeholder="๐ ุงุจุญุซ ูู ุงูุฃุณุฆูุฉ..." style="flex:1;min-width:150px">
          <select id="allq-cat" style="min-width:110px">
            <option value="">ุฌููุน ุงููุฆุงุช</option>
          </select>
          <select id="allq-diff" style="min-width:100px">
            <option value="">ุฌููุน ุงููุณุชููุงุช</option>
            <option value="easy">ุณูู ๐ข</option>
            <option value="medium">ูุชูุณุท ๐ก</option>
            <option value="hard">ุตุนุจ ๐ด</option>
          </select>
        </div>
        <div id="allq-stats" class="text-xs text-muted mb-8"></div>
        <div id="allq-list" style="max-height:60vh;overflow-y:auto;display:flex;flex-direction:column;gap:8px"></div>
      </div>
      <!-- Edit modal inside tab -->
      <div id="allq-edit-panel" class="hidden card" style="border:2px solid var(--accent);margin-bottom:8px">
        <div class="bold mb-8">โ๏ธ ุชุนุฏูู ุงูุณุคุงู</div>
        <textarea id="allq-edit-q" rows="3" style="width:100%;margin-bottom:6px;font-family:var(--font);padding:8px;border-radius:8px;border:1px solid var(--bdr);background:var(--surf);color:var(--text)"></textarea>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px">
          <input type="text" id="allq-edit-o0" placeholder="ุฎูุงุฑ 1">
          <input type="text" id="allq-edit-o1" placeholder="ุฎูุงุฑ 2">
          <input type="text" id="allq-edit-o2" placeholder="ุฎูุงุฑ 3">
          <input type="text" id="allq-edit-o3" placeholder="ุฎูุงุฑ 4">
        </div>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <select id="allq-edit-correct" style="flex:1">
            <option value="0">โ ุงูุตุญูุญ: ุฎูุงุฑ 1</option>
            <option value="1">โ ุงูุตุญูุญ: ุฎูุงุฑ 2</option>
            <option value="2">โ ุงูุตุญูุญ: ุฎูุงุฑ 3</option>
            <option value="3">โ ุงูุตุญูุญ: ุฎูุงุฑ 4</option>
          </select>
          <select id="allq-edit-diff" style="flex:1">
            <option value="easy">ุณูู (+10)</option>
            <option value="medium">ูุชูุณุท (+15)</option>
            <option value="hard">ุตุนุจ (+25)</option>
          </select>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary btn-sm" id="allq-save-edit" style="flex:1">๐พ ุญูุธ</button>
          <button class="btn btn-ghost btn-sm" id="allq-cancel-edit" style="flex:1">โ ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
    <!-- Questions tab -->
    <div id="ptab-questions-content" class="hidden">
      <div class="card">
        <div class="bold mb-8">โ ุฅุถุงูุฉ ุณุคุงู ูุฎุตุต</div>
        <input type="text" id="cq-q" placeholder="ูุต ุงูุณุคุงู..." maxlength="200" style="margin-bottom:6px">
        <div class="grid2" style="gap:6px;margin-bottom:6px">
          <input type="text" id="cq-a" placeholder="ุฎูุงุฑ 1"><input type="text" id="cq-b" placeholder="ุฎูุงุฑ 2">
          <input type="text" id="cq-c" placeholder="ุฎูุงุฑ 3"><input type="text" id="cq-d" placeholder="ุฎูุงุฑ 4">
        </div>
        <select id="cq-correct" style="margin-bottom:6px">
          <option value="0">โ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ุฎูุงุฑ 1</option><option value="1">โ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ุฎูุงุฑ 2</option>
          <option value="2">โ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ุฎูุงุฑ 3</option><option value="3">โ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ุฎูุงุฑ 4</option>
        </select>
        <div class="flex gap-6">
          <select id="cq-diff" style="flex:1"><option value="easy">ุณูู (+10)</option><option value="medium">ูุชูุณุท (+15)</option><option value="hard">ุตุนุจ (+25)</option></select>
          <button class="btn btn-primary btn-sm" id="btn-add-cq">โ ุฅุถุงูุฉ</button>
        </div>
      </div>
      <div class="card mt-8">
        <div class="flex gap-8 mb-8">
          <div class="bold" style="flex:1">๐ ุงูุฃุณุฆูุฉ ุงููุฎุตุตุฉ (<span id="cq-count">0</span>)</div>
          <input type="text" id="cq-search" placeholder="ุจุญุซ..." style="width:130px;padding:5px 8px;font-size:0.8rem">
        </div>
        <div id="cq-list"></div>
      </div>
      <div class="card mt-8">
        <div class="bold mb-8">โฐ ุชูููุช ุงููุณุงุจูุฉ ุงูููููุฉ</div>
        <div class="flex gap-8">
          <select id="quiz-hour" style="flex:1">
            <option value="14">ุงูุณุงุนุฉ 2 ุธูุฑุงู</option><option value="15">ุงูุณุงุนุฉ 3 ุนุตุฑุงู</option>
            <option value="16" selected>ุงูุณุงุนุฉ 4 ุนุตุฑุงู</option><option value="17">ุงูุณุงุนุฉ 5 ูุณุงุกู</option>
          </select>
          <button class="btn btn-primary btn-sm" id="btn-save-quiz-time">๐พ ุญูุธ</button>
        </div>
        <p class="text-xs text-muted mt-8">ูู ุชูุชุญ ุงููุณุงุจูุฉ ูุจู ูุฐุง ุงูููุช</p>
      </div>
    </div>
    <!-- Rewards tab -->
    <div id="ptab-rewards-content" class="hidden">
      <div class="card">
        <div class="bold mb-8">๐ ุฅุถุงูุฉ ููุงูุฃุฉ</div>
        <select id="rew-child" style="margin-bottom:6px"><option value="">ุงุฎุชุฑ ุงูุทูู...</option></select>
        <input type="text" id="rew-desc" placeholder="ูุตู ุงูููุงูุฃุฉ..." style="margin-bottom:6px">
        <button class="btn btn-success btn-block btn-sm" id="btn-add-rew">๐ ุฅุถุงูุฉ ุงูููุงูุฃุฉ</button>
      </div>
      <div class="card mt-8">
        <div class="bold mb-8">๐ ุงูููุงูุขุช ุงูููููุญุฉ</div>
        <div id="rewards-list"><p class="text-muted text-sm text-center">ูุง ุชูุฌุฏ ููุงูุขุช ุจุนุฏ</p></div>
      </div>
    </div>
    <!-- Settings tab -->
    <div id="ptab-settings-content" class="hidden">
      <div class="card"><div class="bold mb-8">๐จ ุงููุธูุฑ</div><div class="theme-grid" id="theme-grid-parent"></div></div>
      <div class="card mt-8"><div class="bold mb-8">โ๏ธ ุฎูุงุฑุงุช ูุชูุฏูุฉ</div><button class="btn btn-danger btn-block" id="btn-reset">๐ ุฅุนุงุฏุฉ ุชุนููู ุงูุดูุฑ</button></div>
      <div class="card mt-8">
        <div class="bold mb-8">๐ ุฅููุงุก ุฑูุถุงู (ุจุนุฏ ุงููุบุฑุจ ููู 29)</div>
        <div class="grid2 gap-8">
          <button class="btn btn-primary btn-sm" id="btn-end-ramadan-29">๐ ุงูุนูุฏ ุบุฏุงู (29 ููู)</button>
          <button class="btn btn-ghost btn-sm" id="btn-continue-30">๐ ุงุณุชูุฑุงุฑ ูููู 30</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== THEME PREVIEW ===== -->
<div id="screen-themes" class="screen">
  <div class="flex gap-8 mb-12"><button class="btn btn-ghost btn-sm" id="btn-themes-back">โ ุฑุฌูุน</button><div class="screen-title" style="flex:1;margin:0">๐จ ุงุฎุชุฑ ุงููุธูุฑ</div></div>
  <div class="theme-grid mb-12" id="theme-grid-main"></div>
  <div class="bold mb-8 text-center">ูุนุงููุฉ ุงููุธูุฑ ุงูุญุงูู</div>
  <div class="theme-preview">
    <div class="theme-preview-title">ุฃูุซูุฉ ุนูู ุงูุนูุงุตุฑ</div>
    <div class="preview-row">
      <button class="btn btn-primary btn-sm">ุฒุฑ ุฑุฆูุณู</button>
      <button class="btn btn-secondary btn-sm">ุฒุฑ ุซุงููู</button>
      <button class="btn btn-ghost btn-sm">ุฒุฑ ูุงุฑุบ</button>
      <button class="btn btn-danger btn-sm">ุชุญุฐูุฑ</button>
    </div>
    <div class="preview-row">
      <span class="badge">ูุณุงู</span>
      <span style="background:var(--green);color:#fff;padding:3px 10px;border-radius:10px;font-size:0.75rem;font-weight:700">ูุฌุงุญ</span>
      <span style="background:var(--rose);color:#fff;padding:3px 10px;border-radius:10px;font-size:0.75rem;font-weight:700">ุชูุจูู</span>
    </div>
    <div class="card" style="margin-top:8px">
      <div class="bold text-sm">ุจุทุงูุฉ ูุนูููุงุช</div>
      <div class="text-muted text-xs mt-8">ูุฐุง ูุต ุชูุถูุญู ุฏุงุฎู ุงูุจุทุงูุฉ</div>
      <button class="btn btn-primary btn-sm mt-8" style="width:100%">ุฒุฑ ุฏุงุฎู ุงูุจุทุงูุฉ</button>
    </div>
    <div style="background:rgba(82,214,138,0.12);border:1px solid var(--green);border-radius:11px;padding:9px 12px;margin-top:8px;font-size:0.85rem;color:var(--green);font-weight:700">โ ุฑุณุงูุฉ ูุฌุงุญ</div>
    <div style="background:rgba(232,93,117,0.12);border:1px solid var(--rose);border-radius:11px;padding:9px 12px;margin-top:8px;font-size:0.85rem;color:var(--rose);font-weight:700">โ๏ธ ุฑุณุงูุฉ ุชุญุฐูุฑ</div>
  </div>
</div>

</div><!-- /app -->

<!-- ===== NAV ===== -->
<nav id="nav">
  <button class="nav-btn" data-s="home" id="nav-home"><span class="nav-i">๐</span><span>ุงูุฑุฆูุณูุฉ</span></button>
  <button class="nav-btn" data-s="progress" id="nav-progress"><span class="nav-i">๐บ๏ธ</span><span>ุฑุญูุชู</span></button>
  <button class="nav-btn" data-s="shop" id="nav-shop"><span class="nav-i">๐ช</span><span>ุงููุชุฌุฑ</span></button>
  <button class="nav-btn" data-s="profiles" id="nav-profiles"><span class="nav-i">๐ฅ</span><span>ุงูุนุงุฆูุฉ</span></button>
  <button class="nav-btn" data-s="themes" id="nav-themes"><span class="nav-i">๐จ</span><span>ุงููุธูุฑ</span></button>
</nav>

<!-- ===== MODALS ===== -->
<div id="m-theme" class="overlay hidden"><div class="sheet"><div class="sheet-handle"></div><div class="modal-title">๐จ ุงุฎุชุฑ ุงููุธูุฑ</div><div class="theme-grid" id="theme-grid-modal"></div><button class="btn btn-primary btn-block mt-12" id="btn-close-theme">โ ุญูุธ</button></div></div>
<div id="m-ate" class="overlay hidden"><div class="sheet"><div class="sheet-handle"></div><div class="modal-title">๐ ูุงุฐุง ุญุฏุซุ</div>
  <div class="flex-col gap-8">
    <button class="btn btn-ghost btn-block" data-r="sick">๐ค ููุช ูุฑูุถุงู (ูุง ุฎุตู + ููุงุท ุฌุฒุฆูุฉ)</button>
    <button class="btn btn-ghost btn-block" data-r="tired">๐ด ุชุนุจุช (ููุงุท ุฌุฒุฆูุฉ)</button>
    <button class="btn btn-ghost btn-block" data-r="forgot">๐ ูุณูุช (ุจุฏูู ุฎุตู)</button>
    <button class="btn btn-ghost btn-block" data-r="intentional">๐ ูุฑุฑุช ุฐูู (ุฎุตู ุงูููุงุท)</button>
  </div>
  <button class="btn btn-ghost btn-block mt-10" id="btn-cancel-ate">ุฅูุบุงุก</button>
</div></div>
<div id="m-chest" class="overlay center hidden"><div class="sheet center-sheet" style="max-width:320px;text-align:center"><div style="font-size:3.5rem">๐</div><div class="modal-title mt-8">ุตูุฏูู ุงูููุงูุฃุฉ!</div><div id="chest-msg" class="text-muted mb-12">ููุงูุฃุฉ!</div><button class="btn btn-primary btn-block" id="btn-close-chest">๐ ุฑุงุฆุน!</button></div></div>
<div id="m-eid-q" class="overlay center hidden"><div class="sheet center-sheet"><div style="font-size:3.5rem;text-align:center">๐โจ</div><div class="modal-title">ููุงู ุงูุนูุฏ</div><p style="text-align:center;margin-bottom:18px">ูู ุฃูุนูู ุฃู ุบุฏุงู ุฃูู ุฃูุงู ุนูุฏ ุงููุทุฑุ</p><div class="grid2 gap-10"><button class="btn btn-primary" style="padding:14px" id="btn-eid-yes">๐ ูุนู! ุงูุนูุฏ ุบุฏุงู</button><button class="btn btn-ghost" style="padding:14px" id="btn-eid-no">๐ ูุงุ ูููู ุงูุซูุงุซูู</button></div></div></div>
<div id="m-eid-cel" class="overlay center hidden"><div class="sheet center-sheet"><div class="eid-wrap"><div style="font-size:4rem;animation:float 2s ease-in-out infinite">๐</div><h1 style="font-size:2rem;color:var(--accent);font-family:'Amiri',serif;margin:12px 0">ุนูุฏ ูุจุงุฑู</h1><p style="color:var(--teal);font-size:1.2rem;margin-bottom:6px">ููู ุนุงู ูุฃูุชู ุจุฎูุฑ ๐</p><div class="winner-card"><div style="font-size:1.6rem">๐</div><div class="bold text-accent">ุจุทู ุฑูุถุงู</div><div id="win-av" style="font-size:2.8rem;margin:6px 0">๐</div><div id="win-name" style="font-size:1.4rem;font-weight:900">โ</div><div id="win-pts" style="color:var(--teal)">0 ููุทุฉ</div></div><div class="flex-col gap-8 mt-12"><button class="btn btn-primary btn-block" id="btn-eid-cert">๐ ุดูุงุฏุชู</button><button class="btn btn-ghost btn-block" id="btn-eid-close">ุฅุบูุงู</button></div></div></div></div>

<!-- ===== TOAST ===== -->
<!-- FAMILY CODE MODAL -->
<div id="m-famcode" class="overlay center hidden">
  <div class="sheet center-sheet" style="max-width:340px">
    <div class="sheet-handle"></div>
    <div class="modal-title">๐ ุฃุฏุฎู ุฑูุฒ ุงูุนุงุฆูุฉ</div>
    <p class="text-muted text-sm mb-8 text-center">ุงุทูุจ ุงูุฑูุฒ ูู ุงููุงูุฏ ูุชุธูุฑ ูู ููุญุฉ ูุชุงุจุนุฉ ุงูุนุงุฆูุฉ</p>
    <input type="text" id="fam-code-input" placeholder="ุฃุฏุฎู ุงูุฑูุฒ ููุง..." maxlength="8" style="text-align:center;font-size:1.5rem;letter-spacing:4px;font-weight:900;text-transform:uppercase;margin-bottom:10px">
    <button class="btn btn-primary btn-block" id="btn-fam-code-submit">โ ุฑุจุท</button>
    <button class="btn btn-ghost btn-block mt-8" id="btn-fam-code-close">ุฅูุบุงุก</button>
  </div>
</div>
<div id="toast"></div>

<script src="./app.js" defer></script>
</body>
</html>
